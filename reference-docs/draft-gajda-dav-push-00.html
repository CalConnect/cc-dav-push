<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Push Discovery and Notification Dispatch Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions Used in This Document"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Terminology"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Architecture"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Application Server"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Push Gateway"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Push Delivery Service"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Client"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Protocol Workflows"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 App Server &lt;-&gt; Push Gateway bootstrap workflow"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Client &lt;-&gt; App Server workflow"/>
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Client discovery and subscription workflow - Generic"/>
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 Unsubscribe"/>
<link href="#rfc.section.5.2.3" rel="Chapter" title="5.2.3 Client discovery and subscription workflow - WebDAV"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 App Server -&gt; Push Gateway subscribe workflow"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 App Server -&gt; Push Gateway push workflow"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Syntax Elements/Properties"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Push gateway protocol"/>
<link href="#rfc.section.6.1.1" rel="Chapter" title="6.1.1 Bootstrapping"/>
<link href="#rfc.section.6.1.2" rel="Chapter" title="6.1.2 Subscription"/>
<link href="#rfc.section.6.1.3" rel="Chapter" title="6.1.3 Update notification"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 XML Element definitions"/>
<link href="#rfc.section.6.2.1" rel="Chapter" title="6.2.1 WebDAV Properties"/>
<link href="#rfc.section.6.2.2" rel="Chapter" title="6.2.2 Subscription request"/>
<link href="#rfc.section.7" rel="Chapter" title="7 HTTP Headers for DAV-Push"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Push-Client-Id Header"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Guidelines"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Application Servers"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Clients"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Push Gateway"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations"/>
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Namespace Registration"/>
<link href="#rfc.references" rel="Chapter" title="11 Normative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Change History (To be removed by RFC Editor before publication)"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Gajda, M." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-gajda-dav-push-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-4-17" />
  <meta name="dct.abstract" content="This specification defines a framework and protocols for a push notification system that allows clients, application servers and push notification servers to interact with each other in a standardized manner.  " />
  <meta name="description" content="This specification defines a framework and protocols for a push notification system that allows clients, application servers and push notification servers to interact with each other in a standardized manner.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">M. Gajda</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">dmfs</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">April 17, 2017</td>
</tr>
<tr>
  <td class="left">Expires: October 19, 2017</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Push Discovery and Notification Dispatch Protocol<br />
  <span class="filename">draft-gajda-dav-push-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This specification defines a framework and protocols for a push notification system that allows clients, application servers and push notification servers to interact with each other in a standardized manner.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 19, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Conventions Used in This Document</a></li>
<li>3.   <a href="#rfc.section.3">Terminology</a></li>
<li>4.   <a href="#rfc.section.4">Architecture</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Application Server</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Push Gateway</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Push Delivery Service</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Client</a></li>
</ul><li>5.   <a href="#rfc.section.5">Protocol Workflows</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">App Server &lt;-&gt; Push Gateway bootstrap workflow</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Client &lt;-&gt; App Server workflow</a></li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">Client discovery and subscription workflow - Generic</a></li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">Unsubscribe</a></li>
<li>5.2.3.   <a href="#rfc.section.5.2.3">Client discovery and subscription workflow - WebDAV</a></li>
</ul><li>5.3.   <a href="#rfc.section.5.3">App Server -&gt; Push Gateway subscribe workflow</a></li>
<li>5.4.   <a href="#rfc.section.5.4">App Server -&gt; Push Gateway push workflow</a></li>
</ul><li>6.   <a href="#rfc.section.6">Syntax Elements/Properties</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Push gateway protocol</a></li>
<ul><li>6.1.1.   <a href="#rfc.section.6.1.1">Bootstrapping</a></li>
<li>6.1.2.   <a href="#rfc.section.6.1.2">Subscription</a></li>
<li>6.1.3.   <a href="#rfc.section.6.1.3">Update notification</a></li>
</ul><li>6.2.   <a href="#rfc.section.6.2">XML Element definitions</a></li>
<ul><li>6.2.1.   <a href="#rfc.section.6.2.1">WebDAV Properties</a></li>
<li>6.2.2.   <a href="#rfc.section.6.2.2">Subscription request</a></li>
</ul></ul><li>7.   <a href="#rfc.section.7">HTTP Headers for DAV-Push</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Push-Client-Id Header</a></li>
</ul><li>8.   <a href="#rfc.section.8">Guidelines</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Application Servers</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Clients</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Push Gateway</a></li>
</ul><li>9.   <a href="#rfc.section.9">Security Considerations</a></li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a></li>
<ul><li>10.1.   <a href="#rfc.section.10.1">Namespace Registration</a></li>
</ul><li>11.   <a href="#rfc.references">Normative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Change History (To be removed by RFC Editor before publication)</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">In a client/server protocol, clients can typically create, update, delete "resources" (data) on the server, as well as retrieve data on the server.  </p>
<p id="rfc.section.1.p.2">In many cases, data can appear on the server as the result of some other client or server-side process interacting with the server. Thus clients need a way to detect when the data on the server has changed.  </p>
<p id="rfc.section.1.p.3">Most protocols provide a data synchronization mechanism to support that, but typically clients need to "poll" the server to find out when changes have occurred. Network based polling is inefficient, and instead push notifications are preferred as a way of alerting clients to new data or changes to existing data on the server </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Conventions Used in This Document</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a> </p>
<p id="rfc.section.2.p.2">When XML element types in the namespaces "DAV:" and "urn:ietf:params:xml:ns:dav-push" are referenced in this document outside of the context of an XML fragment, the string "DAV:" and "DAV-PUSH:" will be prefixed to the element type names respectively.  </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Terminology</h1>
<p/>

<dl>
  <dt>Application Server</dt>
  <dd style="margin-left: 8">Provides resources a client application might want to monitor for changes. Typical applications are email, calendars and address books.  </dd>
  <dt>Push Gateway</dt>
  <dd style="margin-left: 8">A service to provide a common, standardized interface to Push Delivery Services. A Push Gateway provides or relays one or multiple delivery channels, the so called Transports.  </dd>
  <dt>Push Delivery Service</dt>
  <dd style="margin-left: 8">A Service which provides the actual push transport mechanism to the client application.  </dd>
  <dt>Transport</dt>
  <dd style="margin-left: 8">A Transport is a logical channel to a specific Push Delivery Service, provided by a Push Gateway. It is identified by the transport-uri.  </dd>
  <dt>Client Application</dt>
  <dd style="margin-left: 8">An application that uses the services of the Application Server and wants to get notified instantaneously about certain changes on the server. A client application typically runs on a mobile or desktop device.  </dd>
  <dt>Push Notification</dt>
  <dd style="margin-left: 8">A message sent from the Application server to the Client Application to notify the client of an update. The basic information carried by the notification is "there was a change" for a specific Topic.  </dd>
  <dt>Topic</dt>
  <dd style="margin-left: 8">A Topic is a name for a notification feed or channel. Each watchable resource has a Topic that clients can subscribe to.  Each subscriber to a particular topic will receive a notification when a substantial change was made to any of the resources with that Topic.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Architecture</h1>
<p id="rfc.section.4.p.1">This document introduces an entity called "Push Gateway" which acts as a proxy between an application server and a push delivery service. A Push Gateway provides at least one Transport. Each Transport is identified by a URI and connects to exactly one Push Delivery Service.  </p>
<p id="rfc.section.4.p.2">Push Gateways MAY support relaying, so a push gateway might forward all or some notifications to another push gateway.  </p>
<pre>
    +----------------------------+
    |     Application Server     |
    +-----------------------+----+
           ^                |
           |                |
           |                |
           |                |
           |                v
           |      +-------------------------+
           |      |       Push Gateway      |
           |      +---------+---------------+
           |                |
           |                |
           |                |
           |                v
           |      +-------------------------+
           |      |  Push delivery Service  |
           |      +---------+---------------+
           |                |
           |                |
           |                |
           |                |
           |                v
     +-----+--------------------+
     |     Client Application   |
     +--------------------------+
</pre>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> Application Server</h1>
<p id="rfc.section.4.1.p.1">The server is responsible for generating push topics and sending update notifications to the Push Gateway. A push topic is a unique token that identifies the update notification feed of a resource or a group of resources. The topic is forwarded to the Push Gateway whenever a relevant change in one of these resources occurs.  </p>
<p id="rfc.section.4.1.p.2">This document doesn't specify how topics are generated. However, for privacy reasons the topic MUST NOT contain user names, user data (like folder/collection names) or URLs in plain text. If a server doesn't maintain opaque, anonymous identifiers it SHOULD use a hash algorithm, like SHA256, to generate an opaque identifier from resource properties.  </p>
<p id="rfc.section.4.1.p.3">Push topics MAY be generated on a per-user base for shared resources.  </p>
<p id="rfc.section.4.1.p.4">A server MAY change push topics at any time to improve privacy. If doing so the server MUST continue to send out push notifications for the old topic until all subscriptions to that topic have expired.  </p>
<p id="rfc.section.4.1.p.5">The application server maintains a mapping of subscribed push topics to a list of push gateways. It updates this mapping whenever </p>

<ul>
  <li>A new subscription request is received,</li>
  <li>A response from the push gateway indicates that there are no active subscribers for a particular topic.  </li>
</ul>

<p> </p>
<p id="rfc.section.4.1.p.6">The application server doesn't maintain references to push clients, because this information is opaque to the application server.  </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> Push Gateway</h1>
<p id="rfc.section.4.2.p.1">The Push Gateway maintains a mapping of push-topics to a list of subscribed clients and expiration times. It updates the list whenever </p>

<ul>
  <li>it receives a new subscription,</li>
  <li>a subscription expires or</li>
  <li>the Push Delivery Service returns that a specific client is no longer available.  </li>
</ul>

<p> If a push message for a specific topic is received the push gateway will notify all clients with an active (not expired) subscription for that topic.  </p>
<p id="rfc.section.4.2.p.2">A push gateway may relay messages for other gateways. A gateway that supports relaying MUST maintain a map of topics to gateways just like an application server.  </p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> Push Delivery Service</h1>
<p id="rfc.section.4.3.p.1">TBD: Minimum requirements for PDS to support this protocol. Describe what state information the PDS needs to maintain.  </p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> Client</h1>
<p id="rfc.section.4.4.p.1">TBD: what information does the client need to maintain</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> Protocol Workflows</h1>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> App Server &lt;-&gt; Push Gateway bootstrap workflow</h1>
<p id="rfc.section.5.1.p.1">This protocol allows an application server to initialize the supported push transports by querying a set of configured push gateways. This requires that the application server knows the root URL of each configured gateway. In order to retrieve the list of supported transports it posts a JSON object with an empty list of push-transports to each gateway.  </p>
<pre>
POST /gateway
Host: push.example.com
Content-Type: application/json
Content-Length: xxx

{ "push-transports": []}
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: xxx

{ "push-transports": [
  {
    "transport": {
      "transport-uri":
        "https://push.example.com/transport",
      "refresh-interval": 172800,
      "transport-data" : { ... }
    }
  },{
    "transport": {
      "transport-uri":
        "urn:uuid:01234567-0123-0123-0123-0123456789ab",
      "refresh-interval": 172800,
      "transport-data" : { ... }
    }
  }]
}
</pre>
<p id="rfc.section.5.1.p.2">The following request shows the bootstrap request of an application server that was configured with the Push Gateway URL https://push.example.com/gateway </p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> Client &lt;-&gt; App Server workflow</h1>
<p id="rfc.section.5.2.p.1">The communication between Client and Application Server is defined in the respective application protocol. The application protocol needs to be extended in order to support push.  </p>
<p id="rfc.section.5.2.p.2">This document describes the general idea behind the required extensions and gives a concrete definition for a WebDAV extension.  </p>
<h1 id="rfc.section.5.2.1"><a href="#rfc.section.5.2.1">5.2.1.</a> Client discovery and subscription workflow - Generic</h1>
<p id="rfc.section.5.2.1.p.1">TBD: </p>
<h1 id="rfc.section.5.2.2"><a href="#rfc.section.5.2.2">5.2.2.</a> Unsubscribe</h1>
<p id="rfc.section.5.2.2.p.1">This document doesn't specify an explicit unsubscribe method. A client that doesn't wish to receive any further push notifications for a specific topic, MAY send a subscription with an expiration date in the past.  </p>
<p id="rfc.section.5.2.2.p.2">An application server which receives such a subscription MUST handle it like any other subscription. In particular the Application Server MUST </p>

<ul>
  <li>verify the Push Topic and</li>
  <li>forward the susbcription to the Push Gateway.</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.2.p.3">A Push Gateway which receives a subscription with a passed expiration date MUST </p>

<ul>
  <li>remove the client from the list of subscribers to this topic and</li>
  <li>not send out any further push messages to this client.</li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2.3"><a href="#rfc.section.5.2.3">5.2.3.</a> Client discovery and subscription workflow - WebDAV</h1>
<h1 id="rfc.section.5.2.3.1"><a href="#rfc.section.5.2.3.1">5.2.3.1.</a> Push discovery</h1>
<pre>
PROPFIND http://calendar.example.com/calendars/
Content-Type: application/xml
Depth: 0
Content-Length: xxx

&lt;D:propfind xmlns:D="DAV:" xmlns:P="urn:ietf:params:xml:ns:dav-push"&gt;
  &lt;D:prop&gt;
    &lt;P:subscribe-URL&gt; /&gt;
    &lt;P:supported-transport-set /&gt;
    &lt;P:topic /&gt;
    &lt;P:version /&gt;
  &lt;/D:prop&gt;
&lt;/D:propfind&gt;
</pre>
<pre>

HTTP/1.1 207 Multistatus
Content-Type: application/xml; charset=UTF-8
Content-Length: xxx

&lt;D:multistatus xmlns:D="DAV:"&gt;
  &lt;D:response&gt;
    &lt;D:href&gt;/calendars/&lt;/D:href&gt;
    &lt;D:propstat&gt;
      &lt;D:prop&gt;
        &lt;P:subscribe-URL&gt;
          &lt;D:href&gt;https://calendar.example.com/subscribe&lt;/D:href&gt;
        &lt;/P:subscribe-URL&gt;
        &lt;P:supported-transport-set&gt;
          &lt;P:transport /&gt;
          &lt;P:transport&gt;
            &lt;P:transport-uri
&gt;urn:uuid:01234567-0123-0123-0123-0123456789ab&lt;/P:transport-uri&gt;
            &lt;P:transport-data&gt;
              ...
            &lt;/P:transport-data&gt;
            &lt;P:refresh-interval&gt;172800&lt;/P:refresh-interval&gt;
          &lt;/P:transport&gt;
	      &lt;P:transport&gt;
	        &lt;P:transport-uri
&gt;https://push.example.com/transport&lt;/P:transport-uri&gt;
            &lt;P:transport-data&gt;
              ...
            &lt;/P:transport-data&gt;
            &lt;P:refresh-interval&gt;172800&lt;/P:refresh-interval&gt;
          &lt;/P:transport&gt;
        &lt;/P:supported-transport-set&gt;
        &lt;P:topic&gt;123&lt;/P:topic&gt;
        &lt;P:version&gt;1&lt;/P:version&gt;
      &lt;/D:prop&gt;
      &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
    &lt;/D:propstat&gt;
  &lt;/D:response&gt;
&lt;/D:multistatus&gt;
</pre>
<p id="rfc.section.5.2.3.1.p.1">The following example shows a PROPFIND request on a user's calendar home to discover push support.  </p>
<h1 id="rfc.section.5.2.3.2"><a href="#rfc.section.5.2.3.2">5.2.3.2.</a> Push subscribe</h1>
<pre>
POST /subscribe HTTP/1.1
Host: calendar.example.com
Content-Type: application/xml; charset=UTF-8

&lt;P:subscribe xmlns:P="urn:ietf:params:xml:ns:dav-push"&gt;
  &lt;P:topic&gt;123&lt;P:topic&gt;
  &lt;P:topic&gt;abc&lt;P:topic&gt;
  &lt;P:selected-transport&gt;
    &lt;P:transport-uri
      &gt;https://push.example.com/transport&lt;/D:transport-uri&gt;
    &lt;P:client-data&gt;XYZ&lt;/D:client-data&gt;
  &lt;/P:selected-transport&gt;
  &lt;P:expires&gt;2017-10-07T12:00:00Z&lt;/P:expires&gt;
&lt;/P:subscribe&gt;
</pre>
<p id="rfc.section.5.2.3.2.p.1">Calendar server -&gt; Client - CS server advertises its supported push mechanisms Clients request POST to P:subscribe-URL - does the actual subscription to the calendar server: </p>
<p id="rfc.section.5.2.3.2.p.2">TBD: response </p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> App Server -&gt; Push Gateway subscribe workflow</h1>
<p id="rfc.section.5.3.p.1">When a client sends a request to subscribe to specific topics, the application server MUST foward the subscription to the chosen gateway or to the gateway that announced itself as a proxy for the chosen gateway.  </p>
<p id="rfc.section.5.3.p.2">If a gateway acts as a proxy for another gateway it MUST forward the request to the proxied gateway.  </p>
<pre>
POST / HTTP/1.1
Host: push.example.com
Content-Type: application/json

{
  "push-subscribe": {
    "topics": [ "123", "abc" ],
    "transport": {
      "transport-uri": "https://push.example.com/transport",
      "client-data": "XYZ"
    },
    "expires": "2017-10-07T12:00:00Z"
  }
}
</pre>
<p id="rfc.section.5.3.p.3">The following example shows a request to subscribe to two topics.  </p>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{ "push-url": "https://push.example.com/" }
</pre>
<p id="rfc.section.5.3.p.4">TBD: responses A successful response containt the URL to send update messages to. The URL may be different than the transport URL. An Application Server MUST use this URL when sending push notifications to transports provided by clients.  </p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> App Server -&gt; Push Gateway push workflow</h1>
<pre>
POST / HTTP/1.1
Host: push.example.com
Content-Type: application/json

{
  "push": {
    "messages" : [{
      "topic": "123",
      "priority": 100,
      "timestamp": "2017-10-01T14:00:52Z",
      "client-id": "xyz"
    }, {
      "topic": "abc",
      "priority": 0,
      "timestamp": "2017-10-01T14:00:53Z"
    }]
  }
} 
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{ "push-response": {} }
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "push-response": {
	"no-subscribers": [
      { "topic": "123"}
    ]
  }
}
</pre>
<p id="rfc.section.5.4.p.1">Whenever a substantial change occurs in any of the resources, the application server sends a Push Message to the gateway containing the Topics of the resources that have changed.  The following example sends a push notification for the Topics "123" and "abc". The message for Topic "123" also contains a "client-id" to omit any notification to the sole client that modified the resource and caused this push message. The second message has a low priority and no "client-id". Such a message could be generated by multiple clients acknowledging an alarm on a shared calendar.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> Syntax Elements/Properties</h1>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> Push gateway protocol</h1>
<h1 id="rfc.section.6.1.1"><a href="#rfc.section.6.1.1">6.1.1.</a> Bootstrapping</h1>
<pre>
; root element	    
root {
	push-transports
}
					
; a list of push transports supported by a gateway
; in the request sent by the application server this is empty
push-transports "push-transports" [
	* transport
]

transport "transport" {

	; The uri of the transport.
	"transport-uri" : uri,
	
	transport-data?
}

; optional data the client needs to know in order to subscribe
; to allow easy conversion to other formats,
; this object MUST NOT contain structured data.
transport-data "transport-data" {
  ^"": any
}
</pre>
<h1 id="rfc.section.6.1.2"><a href="#rfc.section.6.1.2">6.1.2.</a> Subscription</h1>
<pre>
; root element
root {
	push-subscribe
}
					
; the object describing the subscription
push-subscribe "push-subscribe" {
	topic-list,
	selected-transport,
	expires
}

; The list of topics to subscribe to. Unless a previous
; subscription is updated by a request, existing
; subscriptions won't be affected by new subscriptions.
topic-list "topics" [
	* topic
}
			
; The chosen transport type
selected-transport "selected-transport" {
	
	; The transport-uri of the chosen transport
	"transport-uri" : uri,
	
	; The client-data string as sent by the client
	"client-data" : string
}
	
; The time of when the subscription expires
; must be a UTC timestamp following
; https://tools.ietf.org/html/rfc3339
expires "expires" : RFC 3339 timestamp 

</pre>
<pre>
; root element
root {
	error
}

; the object describing the failure
error "error" {
	invalid-topic-list
}


; The list of topics that the user can't subscribe to
invalid-topic-list "invalid-topics" [
	1* topic
}
</pre>
<h1 id="rfc.section.6.1.3"><a href="#rfc.section.6.1.3">6.1.3.</a> Update notification</h1>
<pre>
; The root object
root {
	"push" [ 1* message ] 
}

; A message object, describing the update  
message {
	topic,
	? priority,
	timestamp,
	? client-id
}

; The topic of the resource that has been updated
topic "topic" : string

; The priority of the change, with 0 being the lowest and 100
; being the highest priority
; If omitted, implementations SHOULD default to 50.
priority "priority" : integer 0..100

; The time of when the change occurred. The value MUST be a
; timestamp in UTC following https://tools.ietf.org/html/rfc3339
; If the server aggregated multiple updates before sending the push
; message, this MUST be the timestamp of the most recent update.
timestamp "timestamp" : RFC 3339 timestamp

; An optional id that identifies the client that triggered the update
; notification. Push gateways can use this information to suppress
; push messages to this particular client, in order to avoid
; unnecessary sync operations.
; If the server aggregated multiple updates from different clients
; into one message, it MUST omit the client-id to ensure all clients
; receive the push message.
client-id "client-id": string

; root element of the push subscribe response
root {
	? no-subscribers-list
}

; A list of topics without active subscribers.
; Applications servers SHOULD not send further push messages for the
; enlisted topics to this transport unless a new client subscribes on
; this transport.
no-subscribers-list "no-subscribers" [
    1* topic }
]

</pre>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> XML Element definitions</h1>
<h1 id="rfc.section.6.2.1"><a href="#rfc.section.6.2.1">6.2.1.</a> WebDAV Properties</h1>
<h1 id="rfc.section.6.2.1.1"><a href="#rfc.section.6.2.1.1">6.2.1.1.</a> DAV-PUSH:push-subscribe-URL</h1>
<pre>
&lt;!ELEMENT push-subscribe-URL (DAV:href)&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">push-subscribe-URL</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the address to send the subscription requests to.  </dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">The push-subscribe-URL element contains exactly one DAV:href element with a URL that points to the subscription service endpoint.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.2"><a href="#rfc.section.6.2.1.2">6.2.1.2.</a> DAV-PUSH:supported-transport-set</h1>
<pre>
&lt;!ELEMENT supported-transport-set (transport*)&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">supported-transport-set</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies a list of transports supported by the application server.  </dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">This element contains the set of push transports supported by the server. The transport-uri element of each transport must be unique within the set of transports.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">The set MAY contain one transport element without any child elements to indicate that the client may provide its own transport.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.3"><a href="#rfc.section.6.2.1.3">6.2.1.3.</a> DAV-PUSH:transport</h1>
<pre>
&lt;!ELEMENT transport (transport-uri,
			transport-data, refresh-interval)?&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">transport</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Describes a specific transport.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">A transport element represents a specific push transport path to clients on a specific service. In general it contains a transport-uri element that uniquely identifies the transport.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.4"><a href="#rfc.section.6.2.1.4">6.2.1.4.</a> DAV-PUSH:transport-uri</h1>
<pre>
&lt;!ELEMENT transport-uri (#PCDATA)&gt;
PCDATA value: The URI identifying the transport.
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">transport-uri</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the URI that identifes the transport.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">Clients compare the provided transport-uris to the transport-uris they support.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.5"><a href="#rfc.section.6.2.1.5">6.2.1.5.</a> DAV-PUSH:transport-data</h1>
<pre>
&lt;!ELEMENT transport-data ANY&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">transport-data</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Contains a list of additional attributes that client needs to know in order to subscribe on this transport.  </dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8"/>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.6"><a href="#rfc.section.6.2.1.6">6.2.1.6.</a> DAV-PUSH:refresh-interval</h1>
<pre>
&lt;!ELEMENT refresh-interval (#PCDATA)&gt;
PCDATA value: the maximum refresh interval in seconds
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">refresh-interval</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the maximum refresh interval.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">Specifies the duration in seconds after which the client is expected to re-subscribe. If the client didn't res-subscribe within this period of time the gateway MUST remove all subscriptions and no further push notifications will be delivered to the client until it subscribes again.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">A Push Gateway MUST not accept subscription requests with an expiration time that would exceed the refresh interval.</dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.7"><a href="#rfc.section.6.2.1.7">6.2.1.7.</a> DAV-PUSH:topic</h1>
<pre>
&lt;!ELEMENT topic (#PCDATA)&gt;
PCDATA value: the push topic
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">topic</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the push topic of a resource.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">The topic identifies the name of the update channel for a resource. Clients send the topic in a subscription request to inform application server and gateway that it wants to receive update notifications for the resource.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">This document doesn't specify a specific format for topics nor a specifc algorithm to generate them.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">Server developers MUST ensure that topics on different installations won't collide.</dd>
  <dt></dt>
  <dd style="margin-left: 8">Resources within the same domain MAY share topics.</dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.1.8"><a href="#rfc.section.6.2.1.8">6.2.1.8.</a> DAV-PUSH:version</h1>
<pre>
&lt;!ELEMENT push-version (#PCDATA)&gt;
PCDATA value: the highest push protocol version number
              supported by the application server
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">push-version</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the highest version number of the push protocol supported by this server.  </dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8"/>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.2"><a href="#rfc.section.6.2.2">6.2.2.</a> Subscription request</h1>
<h1 id="rfc.section.6.2.2.1"><a href="#rfc.section.6.2.2.1">6.2.2.1.</a> DAV-PUSH:subscribe</h1>
<pre>
&lt;!ELEMENT subscribe (topic+, selected-transport,
			expires)&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">subscribe</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Represents a subscription request document.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">The subscribe request contains all information to subscribe to specific topics selecting a specific transport to deliver push notifications.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">A subscription must have an expiration date after which the subscriptions will become void.</dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.2.2"><a href="#rfc.section.6.2.2.2">6.2.2.2.</a> DAV-PUSH:selected-transport</h1>
<pre>
&lt;!ELEMENT selected-transport (transport-uri,
			client-data)&gt;
</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">selected-transport</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Specifies the transport the client has chosen.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">The selected-transport element contains the transport-uri of the transport that the client has chosen for push delivery. It also contains a client-data element to be forwarded to the push gateway.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.6.2.2.3"><a href="#rfc.section.6.2.2.3">6.2.2.3.</a> DAV-PUSH:client-data</h1>
<pre>
&lt;!ELEMENT client-data (#PCDATA)&gt;
PCDATA value: client data as required by the push gateway
</pre>
<pre>

&lt;!ELEMENT invalid-topics (topic+)&gt;

</pre>
<p/>

<dl>
  <dt>Name:</dt>
  <dd style="margin-left: 8">client-data</dd>
  <dt>Namespace:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:dav-push</dd>
  <dt>Purpose:</dt>
  <dd style="margin-left: 8">Contains a string the client needs to provide to the push-gateway for the chosen transport.  </dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">This element provides a mechanism for the client to communicate to the gateway. The format of the data string is not defined in this document. The application server MUST forward the client-data string as provided by the client.  <br/> Gateways SHOULD use this to authenticate clients.  </dd>
  <dt>Definition:</dt>
  <dd style="margin-left: 8"/>
  <dt></dt>
  <dd style="margin-left: 8">
    <dl>
      <dt>Name:</dt>
      <dd style="margin-left: 8">invalid-topics (precondition)</dd>
      <dt>Purpose:</dt>
      <dd style="margin-left: 8">The request could not succeed, because it contained invalid push topics. This element contains one topic element for each rejected push topic. The client may repeat the request without those topics.  </dd>
      <dt>Definition:</dt>
      <dd style="margin-left: 8"/>
    </dl>
    <p> </p>
  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> HTTP Headers for DAV-Push</h1>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> Push-Client-Id Header</h1>
<pre>
Push-Client-Id = "Push-Client-Id" ":" token
</pre>
<p id="rfc.section.7.1.p.1">The client sends this header to identify itself to the application server as the modifying instance. If the application server didn't coalesce multiple updates from different clients into a single push message, it SHOULD include the value in the update notification message.  The provided token (<a href="#RFC7230">[RFC7230]</a>) MUST be percent-encoded as per<a href="#RFC3986">[RFC3986]</a>. Gateways can use this information to suppress push messages to this particular client.  </p>
<p id="rfc.section.7.1.p.2">The actual value of token is part of the contract between client and gateway. The token MUST NOT contain any sensitive data like user name or device identifiers. It SHOULD be either a random or an obfuscated token (using a cryptographic hash function).  </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> Guidelines</h1>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> Application Servers</h1>
<p id="rfc.section.8.1.p.1">Servers may want to implement some form of "keep-alive" within the push protocol to ensures clients know they are still connected in cases where actual data changes happen at long intervals (e.g., a calendar user who only makes changes once a day) </p>
<p id="rfc.section.8.1.p.2">Priorities: Range 0 - 100 - 0 is lowest and 100 is highest e.g.: low priority - updates due to other attendees changing their partstat high priority - updates to events ocurring in the next 24 hours Priority is used by a client to indicate what level of push they want at a specific time. It can also be used by the push gateway or push delivery system to throttle push notifications to the client based on load.  </p>
<p id="rfc.section.8.1.p.3">Servers MAY delay the delivery of push notifications for several seconds in order to coalesce notifications. This is useful to give the server a certain amount of control over the client's behavior during times of high load.  </p>
<p id="rfc.section.8.1.p.4">Servers MUST NOT coalesce push notifications based on priority.  </p>
<p id="rfc.section.8.1.p.5">Application servers MAY allow clients to provide their own transports. If the transport-uri is not among the transport-uris as advertised by the application server, the transport-uri MUST be an HTTPS URL. If a client sends such a transport-uri, the application server SHOULD perform a transport discovery on the provided URL to discover all transports supported on this gateway.  </p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> Clients</h1>
<p id="rfc.section.8.2.p.1">Clients MUST be prepared that they might receive an initial push notification that acknowledges the subscription before the response to the push-subscribe request has been received.  </p>
<p id="rfc.section.8.2.p.2">Clients SHOULD NOT rely solely on push notifications. The framework described in this document does not make any guarantees about the delivery of a push notification. Clients should be prepared to trigger a synchronization themselves if no push message has been received within some time period.  </p>
<p id="rfc.section.8.2.p.3">Clients can expect that sometimes they will get a push but then not detect any actual changes when they sync (i.e., "no-op" push from server as a "keep-alive" mechanism).  </p>
<h1 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> Push Gateway</h1>
<p id="rfc.section.8.3.p.1">A Push Gateway SHOULD require some kind of authentication to be encoded in the client-data string. This document doesn't specify any authentication methods. However, among others, encrypting the client-data string with a shared secret and digitally signing the data are two possible options to achieve this.  </p>
<p id="rfc.section.8.3.p.2">Client data MAY contain additional per-client preferences, like minimum priority to deliver or maximum delay of notifications when doing coalescing. This is part of the contract between client and transport an not subject of this specification.  </p>
<p id="rfc.section.8.3.p.3">Gateways MAY coalesce push notifications based on priority.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> Security Considerations</h1>
<p id="rfc.section.9.p.1">To prevent abuse of the service, Push Gateways SHOULD require either servers or clients or both to authenticate. Servers SHOULD authenticate every request of Protocol #2 via HTTP.  </p>
<p id="rfc.section.9.p.2">Push Gateways use the &lt;gateway-data&gt; information to authenticate subscription requests from a Server by relating them to Client authorization requests. Clients will typically be authenticating to Servers to access protected data on the server and thus SHOULD authenticate when using Protocol #1.  </p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> IANA Considerations</h1>
<p id="rfc.section.10.p.1">This document uses a URN to describe a new XML namespace conforming to the registry mechanism described in<a href="#RFC3688">[RFC3688]</a>.  </p>
<h1 id="rfc.section.10.1"><a href="#rfc.section.10.1">10.1.</a> Namespace Registration</h1>
<p id="rfc.section.10.1.p.1">Registration request for the push namespace: </p>
<p id="rfc.section.10.1.p.2">URI: urn:ietf:params:xml:ns:dav-push </p>
<p id="rfc.section.10.1.p.3">Registrant Contact: The IESG &lt;iesg@ietf.org&gt; </p>
<p id="rfc.section.10.1.p.4">XML: None - not applicable for namespace registrations.  </p>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3339">[RFC3339]</b>
      </td>
      <td class="top"><a>Klyne, G.</a> and <a>C. Newman</a>, "<a href="http://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>", RFC 3339, DOI 10.17487/RFC3339, July 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3688">[RFC3688]</b>
      </td>
      <td class="top"><a>Mealling, M.</a>, "<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>", BCP 81, RFC 3688, DOI 10.17487/RFC3688, January 2004.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3986">[RFC3986]</b>
      </td>
      <td class="top"><a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7230">[RFC7230]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> Change History (To be removed by RFC Editor before publication)</h1>
<p id="rfc.section.A.p.1">Changes in -01: </p>

<ol>
  <li/>
</ol>

<p> </p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marten Gajda</span> 
	  <span class="n hidden">
		<span class="family-name">Gajda</span>
	  </span>
	</span>
	<span class="org vcardline">dmfs GmbH</span>
	<span class="adr">
	  <span class="vcardline">Schandauer Stra&#223;e 34</span>

	  <span class="vcardline">
		<span class="locality">Dresden</span>,  
		<span class="region"></span>
		<span class="code">01309</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:marten@dmfs.org">marten@dmfs.org</a></span>

<span class="vcardline">URI: <a href="http://dmfs.org">http://dmfs.org</a></span>

  </address>
</div>

</body>
</html>
